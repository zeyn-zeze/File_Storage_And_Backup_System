{% extends 'admin_sidebar.html' %}

{% block content %}
<h1>Şifre Değişim Talepleri</h1>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Kullanıcı</th>
            <th>İstek Tarihi</th>
            <th>Durum</th>
            <th>Şifre</th>
            <th>İşlem</th>
        </tr>
    </thead>
    <tbody>
        {% for request in requests %}
        <tr>
            <td>{{ request.user.username }}</td>  <!-- Kullanıcı adı gösterilsin -->
            <td>{{ request.requested_at.strftime('%d-%m-%Y %H:%M') }}</td>  <!-- Tarih formatını daha okunabilir yapalım -->
            <td>
                {% if request.status == 'approved' %}
                    <span style="color: green;">Onaylandı</span>
                {% elif request.status == 'pending' %}
                    <span style="color: orange;">Beklemede</span>
                {% else %}
                    <span style="color: red;">Reddedildi</span>
                {% endif %}
            </td>
            <td>
                <!-- Eğer istek beklemede ise şifre alanı aktif olacak -->
                {% if request.status == 'pending' %}
                    <form method="POST" action="{{ url_for('admin.manage_password_requests') }}">
                        <input type="hidden" name="request_id" value="{{ request.id }}">
                        
                        <button type="submit" class="btn btn-primary">Onayla</button>
                    </form>
                {% else %}
                    <span>-</span>  <!-- Şifreyi sadece bekleyen talepler için girebilir -->
                {% endif %}
            </td>
            <td>
                {% if request.status == 'pending' %}
                    <form method="POST" action="{{ url_for('admin.manage_password_requests') }}">
                        <input type="hidden" name="request_id" value="{{ request.id }}">
                        <button type="submit" class="btn btn-success">Onayla</button>
                    </form>
                {% else %}
                    <span>-</span>  <!-- Onaylanmış veya reddedilmiş talepler için işlem yok -->
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
